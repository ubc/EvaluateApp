-
	// Expects variables metric, score, [user_vote], [transaction_id], [name]
	name = input_name || 'metric-' + metric.metric_id
	options = metric.options || {}
	answers = options['answers'] ? options['answers'].split( /\r?\n/ ) : []
	multiselect = options['multiselect'] || false
	total_votes = score.count || 0
	votes = score.data || {}

ul
	each text, i in answers
		- vote_count = votes[i] || 0
		- user_selected = ( user_vote instanceof Array ? user_vote.indexOf(i) > -1 : user_vote === i )
		li
			label.vote
				input(
					name = name
					type = ( multiselect == 'on' ? 'checkbox' : 'radio' )
					value = i
					checked = ( user_selected )
					autocomplete = "off"
					disabled = ( transaction_id == null )
				)
				span
					| #{text}
			span.score(class="score-" + i, title="Total")
				| #{vote_count}
			br
			progress(
				class = "score-" + i
				max = total_votes
				value = vote_count
			)

script.
	if ( typeof POLL_SCRIPT === 'undefined' ) {
		POLL_SCRIPT = true;
		
		jQuery('.metric-poll').on( 'evaluate-update', function( event, data, choice ) {
			var element = jQuery(this);

			for ( var i in choice ) {
				choice[i] = parseInt( choice[i] );
			}

			for ( var k in data.score_data ) {
				var value = data.score_data[k];
				var score = element.find( 'span.score-' + k );
				var progress = element.find( 'progress.score-' + k )

				score.text( value );
				progress.attr( 'value', value );
				progress.attr( 'max', data.total );
			}

			if ( Object.toString( data.vote ) != Object.toString( choice ) ) {
				element.find( 'input' ).each( function() {
					var input = jQuery(this);
					var checked = data.vote != null && data.vote.indexOf( parseInt( input.val() ) ) > -1;
					input.prop( 'checked', checked );
				} );
			}

			// Prevent the default evaluate-update event
			event.stopImmediatePropagation();
		} );
	}
